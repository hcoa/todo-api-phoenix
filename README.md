[![Build Status](https://travis-ci.org/hcoa/todo-api-phoenix.svg?branch=master)](https://travis-ci.org/hcoa/todo-api-phoenix)

# TodoApi
This is a sample for todo api CRUD. Generated by phoenix framework. 

To start Phoenix app:

  * Install dependencies with `mix deps.get`
  * Create and migrate your database with `mix ecto.create && mix ecto.migrate`
  * Start Phoenix endpoint with `mix phoenix.server`

Now you can go to [`localhost:4000/api/todos`](http://localhost:4000/api/todos) from browser.

## Run in docker with compose

`docker-compose` should be installed

Run todo_api and postgres db in detached mode 
```
docker-compose up -d
```

after create and migrate db
```
docker-compose run web mix do ecto.create, ecto.migrate
```

Now you can create new items. Example with `curl`:

create new item:
```bash
curl -XPOST http://localhost:4000/api/todos \
    -H 'Content-type: application/json' \
    --data '{"todo": {"description":"create todo", "complete":true}}'
```

get all items: 
```bash
curl http://localhost:4000/api/todos
```

update item:
```bash
curl -XPUT http://localhost:4000/api/todos/1 \
    -H 'Content-type: application/json' \
    --data '{"todo", {"description":"update todo", "complete":false}}'
```

delete item:
```bash
curl -XDELETE http://localhost:4000/api/todos/1 \
```


turn off:
```bash
docker-compose down
```

## Deploying to AWS ECS

[ecs-cli](http://docs.aws.amazon.com/AmazonECS/latest/developerguide/ECS_CLI_installation.html) should be installed.

1. Configure ecs.
   [docs](http://docs.aws.amazon.com/AmazonECS/latest/developerguide/ECS_CLI_Configuration.html)
```bash
ecs-cli configure --region us-west-2 --access-key $AWS_ACCESS_KEY_ID --secret-key $AWS_SECRET_ACCESS_KEY --cluster ecs-cli-demo
```
2. Run with command, more commands can be found in [official
   documentation](http://docs.aws.amazon.com/AmazonECS/latest/developerguide/ECS_CLI_tutorial.html):
```bash
ecs-cli compose --file docker-compose.yml up
```

